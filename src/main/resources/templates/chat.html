<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>채팅 서비스</title>
    </head>
    <body>
        <input type="text" id="nickName" class="form-inline" placeholder="닉네임을 입력해주세요" required autofocus>
        <button class = "btn btn-primary" id = "name">확인</button>

        <div id = "chatroom" style = "width:400px; height: 600px; border:1px solid; background-color : gray"></div>
        <input type = "text" id = "message" style = "height : 30px; width : 340px" placeholder="내용을 입력하세요" autofocus>
        <button class = "btn btn-primary" id = "send">전송</button>
    </body>
    <script>
        let webSocket;
        let nickName;
        
        const onClose = () => {};

        const onMessage = (e) => {
            let data = e.data;
            let chatroom = document.getElementById("chatroom");
            chatroom.innerHTML = chatroom.innerHTML + "<br>" + data;
        };

        const onOpen = () => {
            webSocket.send(nickName + "님이 입장하셨습니다.");
        };

        const send = () => {
           let msg = document.getElementById("message").value;
           webSocket.send(nickName + " : " + msg);
           document.getElementById("message").value = "";
        };

        const disconnect = () => {
            webSocket.send(nickName + "님이 퇴장하셨습니다.");
            webSocket.close()
        }

        const connect = () => {
            webSocket = new WebSocket("ws://" + location.host + "/chat");
            webSocket.onopen = onOpen;
            webSocket.onclose = onClose;
            webSocket.onmessage = onMessage;
        };

        document.getElementById("name").addEventListener("click", ()=>{
            nickName = document.getElementById("nickName").value;
            document.getElementById("nickName").style.display="none";
            document.getElementById("name").style.display="none";
            connect();
        });
        
        document.getElementById("send").addEventListener("click", ()=>{send()});

    </script>
</html>